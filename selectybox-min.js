/* Selectybox 1.1  -- (c) 2012-2014 Hugsmiðjan ehf. - MIT/GPL   @preserve */
!function(){"use strict";var e,t=window,n=!!t.addEventListener,r=function(e,t){var r=n?"":"on",s=n?"add"==t?"addEventListener":"removeEventListener":"add"==t?"attachEvent":"detachEvent",o=e.select;o[s](r+"change",e._$refresh),o[s](r+"keyup",e._$refresh),o[s](r+"focus",e._$focus),o[s](r+"blur",e._$blur)},s=function(e,t,n){n=n.split(" ");for(var r,s=0;r=n[s++];)t[r]&&(e[r]=t[r])},o=function(t){return e=e||document.createElement("div"),e.innerHTML=t.replace(/^[^<]+/,""),e.firstChild},a=function(e,t,n){for(var r in t)e.style[r]=n?"":t[r]},i="templ getButton focusClass emptyVal text wrapperCSS selectCSS",c="_$refresh _$focus _$blur select container button",l=function(e,t){var n=e.$selectybox,c=n||this;if(!(c instanceof l))return new l(e,t);n&&n.destroy(),t&&(s(c,t,i),t=null);var u=c.container=o(c.templ);a(u,c.wrapperCSS),c.button=c.getButton(),c.select=e,e.parentNode.insertBefore(u,e),u.insertBefore(e,c.button.nextSibling),e.style.opacity=1e-4,a(e,c.selectCSS),c._$refresh=function(){setTimeout(function(){c.refresh()},0)};var f;return c._$blur=function(){f=f||new RegExp("(?:^| )"+c.focusClass+"( |$)"),u.className=u.className.replace(f,"$1")},c._$focus=function(){u.className+=" "+c.focusClass},r(c,"add"),c.refresh(),e.$selectybox=c,n?c:void 0};l.prototype={templ:'<span class="selecty"><span class="selecty-button"></span></span>',getButton:function(){return this.container.firstChild},focusClass:"focused",emptyVal:"     ",text:function(e){return e},wrapperCSS:{position:"relative"},selectCSS:{position:"absolute",bottom:0,left:0,width:"100%",height:"100%",top:"auto",right:"auto",margin:0,padding:0,border:0},refresh:function(){var e=this,t=e.select;e.button.innerHTML=e.text(t.options[t.selectedIndex].text.replace(/</g,"&lt;"))||e.emptyVal},val:function(e){var t,n=this,r=0;for(e+="";t=n.select.options[r++];)if(t.value===e){t.selected=!0;break}n.refresh()},destroy:function(){var e=this,t=e.select,n=e.container,s=n.parentNode;s.insertBefore(t,n),s.removeChild(n),r(e,"remove"),t.style.opacity="",a(t,e.selectCSS,!0),t.$selectybox="";for(var o=(i+c).split(" "),l=o.length;l--;);delete e[o[l]]}},l.jQueryPlugin=function(e){var t="selectybox-widget";e.fn.selectybox=function(n,r){var s=this;if(/^(?:refresh|val|destroy)$/.test(n))s.each(function(){var s=e(this),o=s.data(t);"destroy"===n&&s.add(o.container).removeData(t),o[n](r)});else if("string"!=typeof n){n.text=n.text||function(t){return e(this.container).toggleClass("selecty-empty",!t),t};var o=s.filter("select").map(function(r,s){var o=l(s,n);return e(s).add(o.container).data(t,o),o.container});return s.pushStack(o)}return s}},"object"==typeof module&&module.exports?module.exports=l:(t.Selectybox=l,t.jQuery&&l.jQueryPlugin(t.jQuery))}();